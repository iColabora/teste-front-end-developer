"use strict";!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery||Zepto)}(function(e){var a=function(a,t,n){var r={invalid:[],getCaret:function(){try{var e,t=0,n=a.get(0),i=document.selection,o=n.selectionStart;return i&&navigator.appVersion.indexOf("MSIE 10")===-1?(e=i.createRange(),e.moveStart("character",-r.val().length),t=e.text.length):(o||"0"===o)&&(t=o),t}catch(e){}},setCaret:function(e){try{if(a.is(":focus")){var t,n=a.get(0);n.setSelectionRange?(n.focus(),n.setSelectionRange(e,e)):(t=n.createTextRange(),t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select())}}catch(e){}},events:function(){a.on("keydown.mask",function(e){a.data("mask-keycode",e.keyCode||e.which)}).on(e.jMaskGlobals.useInput?"input.mask":"keyup.mask",r.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){a.keydown().keyup()},100)}).on("change.mask",function(){a.data("changed",!0)}).on("blur.mask",function(){l===r.val()||a.data("changed")||a.trigger("change"),a.data("changed",!1)}).on("blur.mask",function(){l=r.val()}).on("focus.mask",function(a){n.selectOnFocus===!0&&e(a.target).select()}).on("focusout.mask",function(){n.clearIfNotMatch&&!i.test(r.val())&&r.val("")})},getRegexMask:function(){for(var e,a,n,r,i,l,s=[],c=0;c<t.length;c++)e=o.translation[t.charAt(c)],e?(a=e.pattern.toString().replace(/.{1}$|^.{1}/g,""),n=e.optional,r=e.recursive,r?(s.push(t.charAt(c)),i={digit:t.charAt(c),pattern:a}):s.push(n||r?a+"?":a)):s.push(t.charAt(c).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return l=s.join(""),i&&(l=l.replace(new RegExp("("+i.digit+"(.*"+i.digit+")?)"),"($1)?").replace(new RegExp(i.digit,"g"),i.pattern)),new RegExp(l)},destroyEvents:function(){a.off(["input","keydown","keyup","paste","drop","blur","focusout",""].join(".mask "))},val:function(e){var t,n=a.is("input"),r=n?"val":"text";return arguments.length>0?(a[r]()!==e&&a[r](e),t=a):t=a[r](),t},getMCharsBeforeCount:function(e,a){for(var n=0,r=0,i=t.length;r<i&&r<e;r++)o.translation[t.charAt(r)]||(e=a?e+1:e,n++);return n},caretPos:function(e,a,n,i){var l=o.translation[t.charAt(Math.min(e-1,t.length-1))];return l?Math.min(e+n-a-i,n):r.caretPos(e+1,a,n,i)},behaviour:function(t){t=t||window.event,r.invalid=[];var n=a.data("mask-keycode");if(e.inArray(n,o.byPassKeys)===-1){var i=r.getCaret(),l=r.val(),s=l.length,c=r.getMasked(),d=c.length,u=r.getMCharsBeforeCount(d-1)-r.getMCharsBeforeCount(s-1),m=i<s;return r.val(c),m&&(8!==n&&46!==n&&(i=r.caretPos(i,s,d,u)),r.setCaret(i)),r.callbacks(t)}},getMasked:function(e,a){var i,l,s=[],c=void 0===a?r.val():a+"",d=0,u=t.length,m=0,v=c.length,h=1,p="push",f=-1;for(n.reverse?(p="unshift",h=-1,i=0,d=u-1,m=v-1,l=function(){return d>-1&&m>-1}):(i=u-1,l=function(){return d<u&&m<v});l();){var _=t.charAt(d),g=c.charAt(m),$=o.translation[_];$?(g.match($.pattern)?(s[p](g),$.recursive&&(f===-1?f=d:d===i&&(d=f-h),i===f&&(d-=h)),d+=h):$.optional?(d+=h,m-=h):$.fallback?(s[p]($.fallback),d+=h,m-=h):r.invalid.push({p:m,v:g,e:$.pattern}),m+=h):(e||s[p](_),g===_&&(m+=h),d+=h)}var k=t.charAt(i);return u!==v+1||o.translation[k]||s.push(k),s.join("")},callbacks:function(e){var i=r.val(),o=i!==l,s=[i,e,a,n],c=function(e,a,t){"function"==typeof n[e]&&a&&n[e].apply(this,t)};c("onChange",o===!0,s),c("onKeyPress",o===!0,s),c("onComplete",i.length===t.length,s),c("onInvalid",r.invalid.length>0,[i,e,a,r.invalid,n])}};a=e(a);var i,o=this,l=r.val();t="function"==typeof t?t(r.val(),void 0,a,n):t,o.mask=t,o.options=n,o.remove=function(){var e=r.getCaret();return r.destroyEvents(),r.val(o.getCleanVal()),r.setCaret(e-r.getMCharsBeforeCount(e)),a},o.getCleanVal=function(){return r.getMasked(!0)},o.getMaskedVal=function(e){return r.getMasked(!1,e)},o.init=function(t){if(t=t||!1,n=n||{},o.clearIfNotMatch=e.jMaskGlobals.clearIfNotMatch,o.byPassKeys=e.jMaskGlobals.byPassKeys,o.translation=e.extend({},e.jMaskGlobals.translation,n.translation),o=e.extend(!0,{},o,n),i=r.getRegexMask(),t===!1){n.placeholder&&a.attr("placeholder",n.placeholder),a.data("mask")&&a.attr("autocomplete","off"),r.destroyEvents(),r.events();var l=r.getCaret();r.val(r.getMasked()),r.setCaret(l+r.getMCharsBeforeCount(l,!0))}else r.events(),r.val(r.getMasked())},o.init(!a.is("input"))};e.maskWatchers={};var t=function(){var t=e(this),r={},i="data-mask-",o=t.attr("data-mask");if(t.attr(i+"reverse")&&(r.reverse=!0),t.attr(i+"clearifnotmatch")&&(r.clearIfNotMatch=!0),"true"===t.attr(i+"selectonfocus")&&(r.selectOnFocus=!0),n(t,o,r))return t.data("mask",new a(this,o,r))},n=function(a,t,n){n=n||{};var r=e(a).data("mask"),i=JSON.stringify,o=e(a).val()||e(a).text();try{return"function"==typeof t&&(t=t(o)),"object"!=typeof r||i(r.options)!==i(n)||r.mask!==t}catch(e){}},r=function(e){var a,t=document.createElement("div");return e="on"+e,a=e in t,a||(t.setAttribute(e,"return;"),a="function"==typeof t[e]),t=null,a};e.fn.mask=function(t,r){r=r||{};var i=this.selector,o=e.jMaskGlobals,l=o.watchInterval,s=r.watchInputs||o.watchInputs,c=function(){if(n(this,t,r))return e(this).data("mask",new a(this,t,r))};return e(this).each(c),i&&""!==i&&s&&(clearInterval(e.maskWatchers[i]),e.maskWatchers[i]=setInterval(function(){e(document).find(i).each(c)},l)),this},e.fn.masked=function(e){return this.data("mask").getMaskedVal(e)},e.fn.unmask=function(){return clearInterval(e.maskWatchers[this.selector]),delete e.maskWatchers[this.selector],this.each(function(){var a=e(this).data("mask");a&&a.remove().removeData("mask")})},e.fn.cleanVal=function(){return this.data("mask").getCleanVal()},e.applyDataMask=function(a){a=a||e.jMaskGlobals.maskElements;var n=a instanceof e?a:e(a);n.filter(e.jMaskGlobals.dataMaskAttr).each(t)};var i={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,useInput:r("input"),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};e.jMaskGlobals=e.jMaskGlobals||{},i=e.jMaskGlobals=e.extend(!0,{},i,e.jMaskGlobals),i.dataMask&&e.applyDataMask(),setInterval(function(){e.jMaskGlobals.watchDataMask&&e.applyDataMask()},i.watchInterval)}),$(function(){searchZipcode("#cep_entrega","#endereco_entrega","#cidade_entrega","#estado_entrega","#complemento_entrega","#complemento_entrega"),searchZipcode("#cep_solicitante","#endereco_solicitante","#cidade_solicitante","#estado_solicitante","#complemento_solicitante","#complemento_solicitante"),initMasks(),initNewInsuranceFormEvent(),initTaskFormSubmitEvent(),initRequiredValidationFields(),initCheckSameAddressCheckbox(),initOrderTotal(),initTotal(),$("#search-order").on("click",function(){var e="SELECT p.id AS id, DATE(p.data_de_compra) AS data_de_compra, p.cep AS cep_entrega, p.rua AS endereco_entrega, p.cidade AS cidade_entrega, p.estado AS estado_entrega, s.nome AS nome, s.telefone AS telefone, s.cpf AS cpf, s.cep AS cep_solicitante, s.rua AS endereco_solicitante, s.cidade AS cidade_solicitante, s.estado AS estado_solicitante FROM pedidos p JOIN solicitantes s ON s.id = p.id_solicitante WHERE p.id = "+$("#numero_pedido").val()+" ORDER BY p.data_de_compra";mysqlQuery(e,function(e){JSON.parse(e)&&(e=JSON.parse(e),fillRequesterAndShippingData(e),searchMaterialData(e))})})});var fillRequesterAndShippingData=function(e){new Date(e[0].data_de_compra);$("#data_compra_pedido").val(e[0].data_de_compra.substr(0,10)),$("#nome_solicitante").val(e[0].nome);var a=e[0].cpf.replace(/\D/g,"").match(/(\d{3})(\d{3})(\d{3})(\d{2})/),t=a[1]+"."+a[2]+"."+a[3]+"-"+a[4];$("#cpf_solicitante").val(t),a=e[0].telefone.replace(/\D/g,"").match(/(\d{2})(\d{4})(\d{5})/),null==a&&(a=e[0].telefone.replace(/\D/g,"").match(/(\d{2})(\d{4})(\d{4})/));var n="("+a[1]+") "+a[2]+"-"+a[3];$("#telefone_solicitante").val(n),a=e[0].cep_solicitante.replace(/\D/g,"").match(/(\d{5})(\d{3})/);var r=a[1]+"-"+a[2];$("#cep_solicitante").val(r),$("#endereco_solicitante").val(e[0].endereco_solicitante),$("#cidade_solicitante").val(e[0].cidade_solicitante),$("#estado_solicitante").val(e[0].estado_solicitante),$("#endereco_entrega").val(e[0].endereco_entrega),$("#cidade_entrega").val(e[0].cidade_entrega),a=e[0].cep_entrega.replace(/\D/g,"").match(/(\d{5})(\d{3})/),r=a[1]+"-"+a[2],$("#cep_entrega").val(r),$("#estado_entrega").val(e[0].estado_entrega)},searchMaterialData=function(e){var a=e[0].id,t="SELECT m.id AS id, m.nome AS nome, m.marca AS marca, m.quantidade AS quantidade, m.preco AS preco FROM materiais m JOIN pedidos p ON m.id_pedido = p.id WHERE p.id = "+a;mysqlQuery(t,function(e){e=JSON.parse(e),fillMaterialValues(e),searchInsuranceData(e)})},searchInsuranceData=function(e){var a=e[0].id,t="SELECT m.marca AS marca, i.quantidade AS quantidade, i.preco AS preco, i.descricao AS descricao FROM insumos i JOIN materiais m ON m.id = i.id_material WHERE m.id = "+a;mysqlQuery(t,function(e){e=JSON.parse(e),fillInsuranceValues(e)})},fillInsuranceValues=function(e){$("#can-add-insurance").empty(),$.each(e,function(e,a){var t=$("#can-add-insurance"),n="";n+=createElement("td",a.marca+createHiddenInput("insumo["+e+"][marca]",a.marca)),n+=createElement("td",a.descricao+createHiddenInput("insumo["+e+"][descricao]",a.descricao)),n+=createElement("td",a.quantidade+createHiddenInput("insumo["+e+"][quantidade]",a.quantidade,"id='insumo_quantidade_"+e+"'")),n+=createElement("td",a.preco+createHiddenInput("insumo["+e+"][preco]",a.preco,"id='insumo_valor_"+e+"'"));var r="<tr data-index='"+e+"'>"+n+"</tr>";t.append(r),recalcTotal()})},fillMaterialValues=function(e){$("#fill-material-values").empty(),$.each(e,function(e,a){var t=$("#fill-material-values"),n="";n+=createElement("td",a.nome+createHiddenInput("material["+e+"][nome]",a.nome)),n+=createElement("td",a.marca+createHiddenInput("material["+e+"][marca]",a.marca)),n+=createElement("td",a.quantidade+createHiddenInput("material["+e+"][quantidade]",a.quantidade,"id='material_quantidade_"+e+"'")),n+=createElement("td",a.preco+createHiddenInput("material["+e+"][preco]",a.preco,"id='material_preco_"+e+"'"));var r="<tr data-index='"+e+"'>"+n+"</tr>";t.append(r)})},recalcTotal=function(){$("#order-total-value input").val(0),$("#preco_pedido").val(0),initOrderTotal(),initTotal()},initTotal=function(){$("#can-add-insurance tr").each(function(){var e=$(this),a=e.data("index"),t=$("#insumo_quantidade_"+a).val(),n=$("#insumo_valor_"+a).val(),r=Number(t)*Number(n);calcTotal(r)}),calcTotal(Number($("#preco_pedido").val()))},initOrderTotal=function(){$("#fill-material-values tr").each(function(){var e=$(this),a=e.data("index"),t=$("#material_quantidade_"+a).val(),n=$("#material_preco_"+a).val(),r=Number(t)*Number(n);calcOrderTotal(r)})},calcOrderTotal=function(e){var a=$("#preco_pedido"),t=isNaN(Number(a.val()))?0:Number(a.val());e+=t,a.val(e)},calcTotal=function(e){var a=$("#order-total-value input"),t=isNaN(Number(a.val()))?0:Number(a.val());e+=t,a.val(e)},searchZipcode=function(e,a,t,n,r,i){$(e).on("blur",function(){var o=$(e);if(o.val().length>=8){var l="https://viacep.com.br/ws/"+o.val()+"/json/";$.get(l,function(e){$(a).val(e.logradouro),$(t).val(e.localidade),$(n).val(e.uf),$(r).val(e.complemento),$(i).focus()})}})},validateRequesterInfo=function(){var e=$("#nome_solicitante"),a=$("#cpf_solicitante"),t=$("#telefone_solicitante"),n=$("#cep_solicitante"),r=$("#endereco_solicitante"),i=$("#cidade_solicitante"),o=$("#estado_solicitante"),l=!1;return validateLength(e.val(),3,50)?(e.removeClass("has-error"),$("#nome_solicitante_invalido").html("")):(e.addClass("has-error"),$("#nome_solicitante_invalido").html("Preencha o campo com no mínimo 3 caracteres e no máximo 50"),l=!0),validateCpf(a.val())?(a.removeClass("has-error"),$("#cpf_solicitante_invalido").html("")):(a.addClass("has-error"),$("#cpf_solicitante_invalido").html("CPF inválido"),l=!0),validateTelephone(t.val())?(t.removeClass("has-error"),$("#telefone_solicitante_invalido").html("")):(t.addClass("has-error"),$("#telefone_solicitante_invalido").html("Telefone inválido"),l=!0),validateZipcode(n.val())?(n.removeClass("has-error"),$("#cep_solicitante_invalido").html("")):(n.addClass("has-error"),$("#cep_solicitante_invalido").html("CEP inválido"),l=!0),validateLength(r.val(),5)?(r.removeClass("has-error"),$("#endereco_solicitante_invalido").html("")):(r.addClass("has-error"),$("#endereco_solicitante_invalido").html("Preencha o campo com no mínimo 5 caracteres"),l=!0),validateLength(i.val(),5)?(i.removeClass("has-error"),$("#cidade_solicitante_invalido").html("")):(i.addClass("has-error"),$("#cidade_solicitante_invalido").html("Preencha o campo com no mínimo 5 caracteres"),l=!0),validateUf(o.val())?(o.removeClass("has-error"),$("#estado_solicitante_invalido").html("")):(o.addClass("has-error"),$("#estado_solicitante_invalido").html("Selecione uma UF válida"),l=!0),l},validateShippingAddressInfo=function(){var e=$("#cep_entrega"),a=$("#endereco_entrega"),t=$("#cidade_entrega"),n=$("#estado_entrega"),r=!1;return validateZipcode(e.val())?(e.removeClass("has-error"),$("#cep_entrega_invalido").html("")):(e.addClass("has-error"),$("#cep_entrega_invalido").html("CEP inválido"),r=!0),validateLength(a.val(),5)?(a.removeClass("has-error"),$("#endereco_entrega_invalido").html("")):(a.addClass("has-error"),$("#endereco_entrega_invalido").html("Preencha o campo com no mínimo 5 caracteres"),r=!0),validateLength(t.val(),5)?(t.removeClass("has-error"),$("#cidade_entrega_invalido").html("")):(t.addClass("has-error"),$("#cidade_entrega_invalido").html("Preencha o campo com no mínimo 5 caracteres"),r=!0),validateUf(n.val())?(n.removeClass("has-error"),$("#estado_entrega_invalido").html("")):(n.addClass("has-error"),$("#estado_entrega_invalido").html("Selecione uma UF válida"),r=!0),r},validateOrderInfo=function(){return!0},initCheckSameAddressCheckbox=function(){$("#check_same_address").on("click",function(){var e=$("#can-disable-by-checkbox");e.hasClass("disabled")?(e.removeClass("disabled"),$("#cep_entrega, #endereco_entrega, #cidade_entrega, #estado_entrega, #complemento_entrega").removeAttr("disabled")):(e.addClass("disabled"),$("#cep_entrega, #endereco_entrega, #cidade_entrega, #estado_entrega, #complemento_entrega").attr("disabled","disabled"))})},initTaskFormSubmitEvent=function(){$("#task-form").on("submit",function(e){e.preventDefault(),$(".required").each(function(e,a){var t=$(this).attr("id");$(this).attr("disabled")||""!=$(this).val()?($(this).removeClass("has-error"),$("#"+t+"_invalido").html("")):($(this).addClass("has-error"),$("#"+t+"_invalido").html("Campo Obrigatório"))});var a=!0;validateRequesterInfo()||(a=!0),validateShippingAddressInfo()||(a=!0),validateOrderInfo()||(a=!0),a||$(".required").each(function(e,a){var t=$(this).attr("id");$(this).removeClass("has-error"),$("#"+t+"_invalido").html("")})})},initRequiredValidationFields=function(){$(".required").on("blur",function(){var e=$(this);""==e.val()?e.addClass("has-error"):e.removeClass("has-error")})},initMasks=function(){$("#cep_entrega, #cep_solicitante").mask("00000-000",{clearIfNotMatch:!0}),$("#cpf_solicitante").mask("000.000.000-00",{clearIfNotMatch:!0}),$("#telefone_solicitante").mask("(00) 0000-00009",{clearIfNotMatch:!0})},initNewInsuranceFormEvent=function(){$("#add-new-insurance").on("click",function(e){var a=$("#marca_insumo"),t=$("#preco_insumo"),n=$("#quantidade_insumo"),r=$("#descricao_insumo"),i=!1;if(validateLength(a.val(),2,50)||(a.addClass("has-error"),$("#marca_insumo_invalido").html("Preencha o campo com no mínimo 2 caracteres e no máximo 50"),i=!0),validateNumber(t.val())||(t.addClass("has-error"),$("#preco_insumo_invalido").html("Número inválido"),i=!0),validateInt(n.val())||(n.addClass("has-error"),$("#quantidade_insumo_invalido").html("Número inválido"),i=!0),validateLength(r.val(),3,255)||(r.addClass("has-error"),$("#descricao_insumo_invalido").html("Preencha o campo com no mínimo 3 caracteres e no máximo 255"),i=!0),!i){var o="",l=$("#can-add-insurance tr:last-child").data("index")+1;o+=createElement("td",a.val()+createHiddenInput("insumo["+l+"][marca]",a.val())),o+=createElement("td",r.val()+createHiddenInput("insumo["+l+"][descricao]",r.val())),o+=createElement("td",n.val()+createHiddenInput("insumo["+l+"][quantidade]",n.val(),"id='insumo_quantidade_"+l+"'")),o+=createElement("td",t.val()+createHiddenInput("insumo["+l+"][preco]",t.val(),"id='insumo_preco_'"+l+"'"));var s="<tr data-index='"+l+"'>"+o+"</tr>";$("#can-add-insurance").append(s),$("#new-insurance-modal .close").click();var c=Number(n.val())*Number(t.val());return calcTotal(c),a.val(""),t.val(""),n.val(""),r.val(""),!0}return!1})};